<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Sequential pair-copula selection and maximum penalized likelihood estimation 
of a GAM-Vine model. — gamVineCopSelect • gamCopula</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">gamCopula</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/tvatter/gamCopula">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Sequential pair-copula selection and maximum penalized likelihood estimation 
of a GAM-Vine model.</h1>
    </div>

    
    <p>This function select the copula family and estimates the parameter(s) of a 
Generalized Additive model 
(GAM) Vine model, where GAMs for individual edges are specified either for
the copula parameter or Kendall's tau.
It solves the maximum penalized likelihood estimation for the copula families 
supported in this package by reformulating each Newton-Raphson iteration as 
a generalized ridge regression, which is solved using 
the <code><a href='http://www.rdocumentation.org/packages/mgcv/topics/mgcv-package'>mgcv</a></code> package.</p>
    

    <pre class="usage"><span class='fu'>gamVineCopSelect</span>(<span class='no'>data</span>, <span class='no'>Matrix</span>, <span class='kw'>lin.covs</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>smooth.covs</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>simplified</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>familyset</span> <span class='kw'>=</span> <span class='fl'>NA</span>, <span class='kw'>rotations</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>familycrit</span> <span class='kw'>=</span> <span class='st'>"AIC"</span>, <span class='kw'>level</span> <span class='kw'>=</span> <span class='fl'>0.05</span>, <span class='kw'>trunclevel</span> <span class='kw'>=</span> <span class='fl'>NA</span>, <span class='kw'>tau</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"FS"</span>, <span class='kw'>tol.rel</span> <span class='kw'>=</span> <span class='fl'>0.001</span>, <span class='kw'>n.iters</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>select.once</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>A matrix or data frame containing the data in [0,1]^d.</p></td>
    </tr>
    <tr>
      <th>Matrix</th>
      <td><p>Lower triangular <code>d x d</code> matrix that defines the R-vine 
tree structure.</p></td>
    </tr>
    <tr>
      <th>lin.covs</th>
      <td><p>A matrix or data frame containing the parametric (i.e., 
linear) covariates (default: <code>lin.covs = NULL</code>).</p></td>
    </tr>
    <tr>
      <th>smooth.covs</th>
      <td><p>A matrix or data frame containing the non-parametric 
(i.e., smooth) covariates (default: <code>smooth.covs = NULL</code>).</p></td>
    </tr>
    <tr>
      <th>simplified</th>
      <td><p>If <code>TRUE</code>, then a simplified vine is fitted (which is
possible only if there are exogenous covariates). If <code>FALSE</code> (default),
then a non-simplified vine is fitted.</p></td>
    </tr>
    <tr>
      <th>familyset</th>
      <td><p>An integer vector of pair-copula families to select from 
(the independence copula MUST NOT be specified in this vector unless one 
wants to fit an independence vine!). The vector has to include at least one 
pair-copula family that allows for positive and one that allows for negative 
dependence. Not listed copula families might be included to better handle 
limit cases. If <code>familyset = NA</code> (default), selection among all 
possible families is performed. Coding of pair-copula families:  
<code>1</code> Gaussian, <code>2</code> Student t, 
<code>3</code> Clayton, <code>4</code> Gumbel, <code>13</code> Survival Clayton, 
<code>14</code> Survival Gumbel,  <code>23</code> Rotated (90 degrees) Clayton, 
<code>24</code> Rotated (90 degrees) Gumbel, 
<code>33</code> Rotated (270 degrees) Clayton and 
<code>34</code> Rotated (270 degrees) Gumbel.</p></td>
    </tr>
    <tr>
      <th>rotations</th>
      <td><p>If <code>TRUE</code>, all rotations of the families in familyset 
are included.</p></td>
    </tr>
    <tr>
      <th>familycrit</th>
      <td><p>Character indicating the criterion for bivariate copula 
selection. Possible choices: <code>familycrit = 'AIC'</code> (default) or 
<code>'BIC'</code>, as in <code>BiCopSelect</code> from the 
<code><a href='http://www.rdocumentation.org/packages/VineCopula/topics/VineCopula-package'>VineCopula</a></code> package.</p></td>
    </tr>
    <tr>
      <th>level</th>
      <td><p>Numerical; Passed to <code><a href='gamBiCopSelect.html'>gamBiCopSelect</a></code>, it is the
significance level of the test for removing individual
predictors (default: <code>level = 0.05</code>) for each conditional pair-copula.</p></td>
    </tr>
    <tr>
      <th>trunclevel</th>
      <td><p>Integer; level of truncation.</p></td>
    </tr>
    <tr>
      <th>tau</th>
      <td><p><code>TRUE</code> (default) for a calibration function specified for 
Kendall's tau or <code>FALSE</code> for a calibration function specified 
for the Copula parameter.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p><code>'NR'</code> for Newton-Raphson
and  <code>'FS'</code> for Fisher-scoring (default).</p></td>
    </tr>
    <tr>
      <th>tol.rel</th>
      <td><p>Relative tolerance for <code>'FS'</code>/<code>'NR'</code> algorithm.</p></td>
    </tr>
    <tr>
      <th>n.iters</th>
      <td><p>Maximal number of iterations for 
<code>'FS'</code>/<code>'NR'</code> algorithm.</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p><code>TRUE</code> (default) for parallel selection of copula 
family at each edge or <code>FALSE</code> for the sequential version.
for the Copula parameter.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p><code>TRUE</code> if informations should be printed during the 
estimation and <code>FALSE</code> (default) for a silent version.
from <code><a href='http://www.rdocumentation.org/packages/mgcv/topics/mgcv-package'>mgcv</a></code>.</p></td>
    </tr>
    <tr>
      <th>select.once</th>
      <td><p>if <code>TRUE</code> the GAM structure is only selected once,
for the family that appears first in <code>familyset</code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>gamVineCopSelect</code> returns a <code><a href='gamVine-class.html'>gamVine-class</a></code> object.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='gamVineSeqFit.html'>gamVineSeqFit</a></code>,<code><a href='gamVineStructureSelect.html'>gamVineStructureSelect</a></code>, 
 <code><a href='gamVine-class.html'>gamVine-class</a></code>, <code><a href='gamVineSimulate.html'>gamVineSimulate</a></code> and 
 <code><a href='gamBiCopFit.html'>gamBiCopFit</a></code>.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>require</span>(<span class='no'>mgcv</span>)
<span class='fu'>set.seed</span>(<span class='fl'>0</span>)

<span class='co'>##  Simulation parameters</span>
<span class='co'># Sample size</span>
<span class='no'>n</span> <span class='kw'>&lt;-</span> <span class='fl'>1e3</span>
<span class='co'># Copula families</span>
<span class='no'>familyset</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='fl'>1</span>:<span class='fl'>2</span>,<span class='fl'>301</span>:<span class='fl'>304</span>,<span class='fl'>401</span>:<span class='fl'>404</span>)
<span class='co'># Define a 4-dimensional R-vine tree structure matrix</span>
<span class='no'>d</span> <span class='kw'>&lt;-</span> <span class='fl'>4</span>
<span class='no'>Matrix</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='fl'>2</span>,<span class='fl'>3</span>,<span class='fl'>4</span>,<span class='fl'>1</span>,<span class='fl'>0</span>,<span class='fl'>3</span>,<span class='fl'>4</span>,<span class='fl'>1</span>,<span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>4</span>,<span class='fl'>1</span>,<span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>1</span>)
<span class='no'>Matrix</span> <span class='kw'>&lt;-</span> <span class='fu'>matrix</span>(<span class='no'>Matrix</span>,<span class='no'>d</span>,<span class='no'>d</span>)
<span class='no'>nnames</span> <span class='kw'>&lt;-</span> <span class='fu'>paste</span>(<span class='st'>"X"</span>, <span class='fl'>1</span>:<span class='no'>d</span>, <span class='kw'>sep</span> <span class='kw'>=</span> <span class='st'>""</span>)

<span class='co'>## A function factory</span>
<span class='no'>eta0</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>calib.surf</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(
  <span class='no'>calib.quad</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>t</span>, <span class='no'>Ti</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='no'>Tf</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='no'>b</span> <span class='kw'>=</span> <span class='fl'>8</span>) {
    <span class='no'>Tm</span> <span class='kw'>&lt;-</span> (<span class='no'>Tf</span> - <span class='no'>Ti</span>)/<span class='fl'>2</span>
    <span class='no'>a</span> <span class='kw'>&lt;-</span> -(<span class='no'>b</span>/<span class='fl'>3</span>) * (<span class='no'>Tf</span>^<span class='fl'>2</span> - <span class='fl'>3</span> * <span class='no'>Tf</span> * <span class='no'>Tm</span> + <span class='fl'>3</span> * <span class='no'>Tm</span>^<span class='fl'>2</span>)
    <span class='fu'>return</span>(<span class='no'>a</span> + <span class='no'>b</span> * (<span class='no'>t</span> - <span class='no'>Tm</span>)^<span class='fl'>2</span>)},
  <span class='no'>calib.sin</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>t</span>, <span class='no'>Ti</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='no'>Tf</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='no'>b</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='no'>f</span> <span class='kw'>=</span> <span class='fl'>1</span>) {
    <span class='no'>a</span> <span class='kw'>&lt;-</span> <span class='no'>b</span> * (<span class='fl'>1</span> - <span class='fl'>2</span> * <span class='no'>Tf</span> * <span class='no'>pi</span>/(<span class='no'>f</span> * <span class='no'>Tf</span> * <span class='no'>pi</span> +
                                 <span class='fu'>cos</span>(<span class='fl'>2</span> * <span class='no'>f</span> * <span class='no'>pi</span> * (<span class='no'>Tf</span> - <span class='no'>Ti</span>))
                               - <span class='fu'>cos</span>(<span class='fl'>2</span> * <span class='no'>f</span> * <span class='no'>pi</span> * <span class='no'>Ti</span>)))
    <span class='fu'>return</span>((<span class='no'>a</span> + <span class='no'>b</span>)/<span class='fl'>2</span> + (<span class='no'>b</span> - <span class='no'>a</span>) * <span class='fu'>sin</span>(<span class='fl'>2</span> * <span class='no'>f</span> * <span class='no'>pi</span> * (<span class='no'>t</span> - <span class='no'>Ti</span>))/<span class='fl'>2</span>)},
  <span class='no'>calib.exp</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>t</span>, <span class='no'>Ti</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='no'>Tf</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='no'>b</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='no'>s</span> <span class='kw'>=</span> <span class='no'>Tf</span>/<span class='fl'>8</span>) {
    <span class='no'>Tm</span> <span class='kw'>&lt;-</span> (<span class='no'>Tf</span> - <span class='no'>Ti</span>)/<span class='fl'>2</span>
    <span class='no'>a</span> <span class='kw'>&lt;-</span> (<span class='no'>b</span> * <span class='no'>s</span> * <span class='fu'>sqrt</span>(<span class='fl'>2</span> * <span class='no'>pi</span>)/<span class='no'>Tf</span>) * (<span class='fu'>pnorm</span>(<span class='fl'>0</span>, <span class='no'>Tm</span>, <span class='no'>s</span>) - <span class='fu'>pnorm</span>(<span class='no'>Tf</span>, <span class='no'>Tm</span>, <span class='no'>s</span>))
    <span class='fu'>return</span>(<span class='no'>a</span> + <span class='no'>b</span> * <span class='fu'>exp</span>(-(<span class='no'>t</span> - <span class='no'>Tm</span>)^<span class='fl'>2</span>/(<span class='fl'>2</span> * <span class='no'>s</span>^<span class='fl'>2</span>)))})

<span class='co'>##  Create the model</span>
<span class='co'># Define gam-vine model list</span>
<span class='no'>count</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>model</span> <span class='kw'>&lt;-</span> <span class='fu'>vector</span>(<span class='kw'>mode</span> <span class='kw'>=</span> <span class='st'>"list"</span>, <span class='kw'>length</span> <span class='kw'>=</span> <span class='no'>d</span>*(<span class='no'>d</span>-<span class='fl'>1</span>)/<span class='fl'>2</span>)
<span class='no'>sel</span> <span class='kw'>&lt;-</span> <span class='fu'>seq</span>(<span class='no'>d</span>,<span class='no'>d</span>^<span class='fl'>2</span>-<span class='no'>d</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='no'>d</span>)

<span class='co'># First tree</span>
<span class='kw'>for</span> (<span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:(<span class='no'>d</span>-<span class='fl'>1</span>)) {
  <span class='co'># Select a copula family</span>
  <span class='no'>family</span> <span class='kw'>&lt;-</span> <span class='fu'>sample</span>(<span class='no'>familyset</span>, <span class='fl'>1</span>)
  <span class='no'>model</span><span class='kw'>[[</span><span class='no'>count</span>]]$<span class='no'>family</span> <span class='kw'>&lt;-</span> <span class='no'>family</span>

  <span class='co'># Use the canonical link and a randomly generated parameter </span>
  <span class='kw'>if</span> (<span class='fu'>is.element</span>(<span class='no'>family</span>,<span class='fu'>c</span>(<span class='fl'>1</span>,<span class='fl'>2</span>))) {
    <span class='no'>model</span><span class='kw'>[[</span><span class='no'>count</span>]]$<span class='no'>par</span> <span class='kw'>&lt;-</span> <span class='fu'>tanh</span>(<span class='fu'>rnorm</span>(<span class='fl'>1</span>)/<span class='fl'>2</span>)
    <span class='kw'>if</span> (<span class='no'>family</span> <span class='kw'>==</span> <span class='fl'>2</span>) {
      <span class='no'>model</span><span class='kw'>[[</span><span class='no'>count</span>]]$<span class='no'>par2</span> <span class='kw'>&lt;-</span> <span class='fl'>2</span>+<span class='fu'>exp</span>(<span class='fu'>rnorm</span>(<span class='fl'>1</span>))
    }
  } <span class='kw'>else</span> {
    <span class='kw'>if</span> (<span class='fu'>is.element</span>(<span class='no'>family</span>,<span class='fu'>c</span>(<span class='fl'>401</span>:<span class='fl'>404</span>))) {
      <span class='no'>rr</span> <span class='kw'>&lt;-</span> <span class='fu'>rnorm</span>(<span class='fl'>1</span>)
      <span class='no'>model</span><span class='kw'>[[</span><span class='no'>count</span>]]$<span class='no'>par</span> <span class='kw'>&lt;-</span> <span class='fu'>sign</span>(<span class='no'>rr</span>)*(<span class='fl'>1</span>+<span class='fu'>abs</span>(<span class='no'>rr</span>))
    } <span class='kw'>else</span> {
      <span class='no'>model</span><span class='kw'>[[</span><span class='no'>count</span>]]$<span class='no'>par</span> <span class='kw'>&lt;-</span> <span class='fu'>rnorm</span>(<span class='fl'>1</span>)
    }
    <span class='no'>model</span><span class='kw'>[[</span><span class='no'>count</span>]]$<span class='no'>par2</span> <span class='kw'>&lt;-</span> <span class='fl'>0</span>
  }
  <span class='no'>count</span> <span class='kw'>&lt;-</span> <span class='no'>count</span> + <span class='fl'>1</span>
}

<span class='co'># A dummy dataset</span>
<span class='no'>data</span> <span class='kw'>&lt;-</span> <span class='fu'>data.frame</span>(<span class='kw'>u1</span> <span class='kw'>=</span> <span class='fu'>runif</span>(<span class='fl'>1e2</span>), <span class='kw'>u2</span> <span class='kw'>=</span> <span class='fu'>runif</span>(<span class='fl'>1e2</span>), <span class='fu'>matrix</span>(<span class='fu'>runif</span>(<span class='fl'>1e2</span>*<span class='no'>d</span>),<span class='fl'>1e2</span>,<span class='no'>d</span>))

<span class='co'># Trees 2 to (d-1)</span>
<span class='kw'>for</span>(<span class='no'>j</span> <span class='kw'>in</span> <span class='fl'>2</span>:(<span class='no'>d</span>-<span class='fl'>1</span>)){
  <span class='kw'>for</span>(<span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:(<span class='no'>d</span>-<span class='no'>j</span>)){
    <span class='co'># Select a copula family</span>
    <span class='no'>family</span> <span class='kw'>&lt;-</span> <span class='fu'>sample</span>(<span class='no'>familyset</span>, <span class='fl'>1</span>)

    <span class='co'># Select the conditiong set and create a model formula</span>
    <span class='no'>cond</span> <span class='kw'>&lt;-</span> <span class='no'>nnames</span>[<span class='fu'>sort</span>(<span class='no'>Matrix</span>[(<span class='no'>d</span>-<span class='no'>j</span>+<span class='fl'>2</span>):<span class='no'>d</span>,<span class='no'>i</span>])]
    <span class='no'>tmpform</span> <span class='kw'>&lt;-</span> <span class='fu'>paste</span>(<span class='st'>"~"</span>,<span class='fu'>paste</span>(<span class='fu'>paste</span>(<span class='st'>"s("</span>, <span class='no'>cond</span>, <span class='st'>", k=10, bs='cr')"</span>,
                                     <span class='kw'>sep</span> <span class='kw'>=</span> <span class='st'>""</span>), <span class='kw'>collapse</span><span class='kw'>=</span><span class='st'>" + "</span>))
    <span class='no'>l</span> <span class='kw'>&lt;-</span> <span class='fu'>length</span>(<span class='no'>cond</span>)
    <span class='no'>temp</span> <span class='kw'>&lt;-</span> <span class='fu'>sample</span>(<span class='fl'>3</span>, <span class='no'>l</span>, <span class='kw'>replace</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

    <span class='co'># Spline approximation of the true function</span>
    <span class='no'>m</span> <span class='kw'>&lt;-</span> <span class='fl'>1e2</span>
    <span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>matrix</span>(<span class='fu'>seq</span>(<span class='fl'>0</span>,<span class='fl'>1</span>,<span class='kw'>length.out</span><span class='kw'>=</span><span class='no'>m</span>), <span class='kw'>nrow</span> <span class='kw'>=</span> <span class='no'>m</span>, <span class='kw'>ncol</span> <span class='kw'>=</span> <span class='fl'>1</span>)
    <span class='kw'>if</span>(<span class='no'>l</span> <span class='kw'>!=</span> <span class='fl'>1</span>){
      <span class='no'>tmp.fct</span> <span class='kw'>&lt;-</span> <span class='fu'>paste</span>(<span class='st'>"function(x){eta0+"</span>,
                       <span class='fu'>paste</span>(<span class='fu'>sapply</span>(<span class='fl'>1</span>:<span class='no'>l</span>, <span class='kw'>function</span>(<span class='no'>x</span>)
                         <span class='fu'>paste</span>(<span class='st'>"calib.surf[["</span>,<span class='no'>temp</span>[<span class='no'>x</span>],<span class='st'>"]](x["</span>,<span class='no'>x</span>,<span class='st'>"])"</span>,
                               <span class='kw'>sep</span><span class='kw'>=</span><span class='st'>""</span>)), <span class='kw'>collapse</span><span class='kw'>=</span><span class='st'>"+"</span>),<span class='st'>"}"</span>,<span class='kw'>sep</span><span class='kw'>=</span><span class='st'>""</span>)
      <span class='no'>tmp.fct</span> <span class='kw'>&lt;-</span> <span class='fu'>eval</span>(<span class='fu'>parse</span>(<span class='kw'>text</span> <span class='kw'>=</span> <span class='no'>tmp.fct</span>))
      <span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>eval</span>(<span class='fu'>parse</span>(<span class='kw'>text</span> <span class='kw'>=</span> <span class='fu'>paste0</span>(<span class='st'>"expand.grid("</span>,
                                   <span class='fu'>paste0</span>(<span class='fu'>rep</span>(<span class='st'>"x"</span>,<span class='no'>l</span>), <span class='kw'>collapse</span> <span class='kw'>=</span> <span class='st'>","</span>),<span class='st'>")"</span>,
                                   <span class='kw'>collapse</span> <span class='kw'>=</span> <span class='st'>""</span>)))
      <span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'>apply</span>(<span class='no'>x</span>,<span class='fl'>1</span>,<span class='no'>tmp.fct</span>)
    }<span class='kw'>else</span>{
      <span class='no'>tmp.fct</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>eta0</span>+<span class='no'>calib.surf</span><span class='kw'>[[</span><span class='no'>temp</span>]](<span class='no'>x</span>)
      <span class='fu'>colnames</span>(<span class='no'>x</span>) <span class='kw'>&lt;-</span> <span class='no'>cond</span>
      <span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'>tmp.fct</span>(<span class='no'>x</span>)
    }

    <span class='co'># Estimate the gam model</span>
    <span class='no'>form</span> <span class='kw'>&lt;-</span> <span class='fu'>as.formula</span>(<span class='fu'>paste0</span>(<span class='st'>"y"</span>, <span class='no'>tmpform</span>))
    <span class='no'>dd</span> <span class='kw'>&lt;-</span> <span class='fu'>data.frame</span>(<span class='no'>y</span>, <span class='no'>x</span>)
    <span class='fu'>names</span>(<span class='no'>dd</span>) <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='st'>"y"</span>, <span class='no'>cond</span>)
    <span class='no'>b</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/mgcv/topics/gam'>gam</a></span>(<span class='no'>form</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>dd</span>)
    <span class='co'>#plot(x[,1],(y-fitted(b))/y)</span>

    <span class='co'># Create a dummy gamBiCop object</span>
    <span class='no'>tmp</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gamBiCopFit.html'>gamBiCopFit</a></span>(<span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>data</span>, <span class='kw'>formula</span> <span class='kw'>=</span> <span class='no'>form</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>n.iters</span> <span class='kw'>=</span> <span class='fl'>1</span>)$<span class='no'>res</span>

    <span class='co'># Update the copula family and the model coefficients</span>
    <span class='fu'>attr</span>(<span class='no'>tmp</span>, <span class='st'>"model"</span>)$<span class='no'>coefficients</span> <span class='kw'>&lt;-</span> <span class='fu'>coefficients</span>(<span class='no'>b</span>)
    <span class='fu'>attr</span>(<span class='no'>tmp</span>, <span class='st'>"model"</span>)$<span class='no'>smooth</span> <span class='kw'>&lt;-</span> <span class='no'>b</span>$<span class='no'>smooth</span>
    <span class='fu'>attr</span>(<span class='no'>tmp</span>, <span class='st'>"family"</span>) <span class='kw'>&lt;-</span> <span class='no'>family</span>
    <span class='kw'>if</span> (<span class='no'>family</span> <span class='kw'>==</span> <span class='fl'>2</span>) {
      <span class='fu'>attr</span>(<span class='no'>tmp</span>, <span class='st'>"par2"</span>) <span class='kw'>&lt;-</span> <span class='fl'>2</span>+<span class='fu'>exp</span>(<span class='fu'>rnorm</span>(<span class='fl'>1</span>))
    }
    <span class='no'>model</span><span class='kw'>[[</span><span class='no'>count</span>]] <span class='kw'>&lt;-</span> <span class='no'>tmp</span>
    <span class='no'>count</span> <span class='kw'>&lt;-</span> <span class='no'>count</span>+<span class='fl'>1</span>
  }
}

<span class='co'># Create the gamVineCopula object</span>
<span class='no'>GVC</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gamVine.html'>gamVine</a></span>(<span class='kw'>Matrix</span><span class='kw'>=</span><span class='no'>Matrix</span>,<span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>model</span>,<span class='kw'>names</span><span class='kw'>=</span><span class='no'>nnames</span>)
<span class='fu'>print</span>(<span class='no'>GVC</span>)</div><div class='output co'>#&gt; GAM-Vine matrix: 
#&gt;      [,1] [,2] [,3] [,4]
#&gt; [1,]    2    0    0    0
#&gt; [2,]    3    3    0    0
#&gt; [3,]    4    4    4    0
#&gt; [4,]    1    1    1    1
#&gt; 
#&gt;  Where 
#&gt; 1  &lt;-&gt;  X1 
#&gt; 2  &lt;-&gt;  X2 
#&gt; 3  &lt;-&gt;  X3 
#&gt; 4  &lt;-&gt;  X4 
#&gt; 
#&gt;  Tree 1: 
#&gt; X2,X1: Gumbel type 3 (survival and 90 degrees rotated) 
#&gt; X3,X1: Clayton type 4 (survival and 270 degrees rotated) 
#&gt; X4,X1: Gumbel type 3 (survival and 90 degrees rotated) 
#&gt; 
#&gt;  Tree 2: 
#&gt; X2,X4|X1 : Gumbel type 4 (survival and 270 degrees rotated) copula with tau(z) = (exp(z)-1)/(exp(z)+1) where 
#&gt; z ~ s(X1, k = 10, bs = "cr")
#&gt; X3,X4|X1 : Gumbel type 4 (survival and 270 degrees rotated) copula with tau(z) = (exp(z)-1)/(exp(z)+1) where 
#&gt; z ~ s(X1, k = 10, bs = "cr")
#&gt; 
#&gt;  Tree 3: 
#&gt; X2,X3|X4,X1 : Clayton type 4 (survival and 270 degrees rotated) copula with tau(z) = (exp(z)-1)/(exp(z)+1) where 
#&gt; z ~ s(X1, k = 10, bs = "cr") + s(X4, k = 10, bs = "cr")</div><div class='input'>
</div><span class='co'># NOT RUN {</span>
<span class='co'>## Simulate and fit the model</span>
<span class='no'>sim</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gamVineSimulate.html'>gamVineSimulate</a></span>(<span class='no'>n</span>, <span class='no'>GVC</span>)
<span class='no'>fitGVC</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gamVineSeqFit.html'>gamVineSeqFit</a></span>(<span class='no'>sim</span>, <span class='no'>GVC</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='no'>fitGVC2</span> <span class='kw'>&lt;-</span> <span class='fu'>gamVineCopSelect</span>(<span class='no'>sim</span>, <span class='no'>Matrix</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='co'>## Plot the results</span>
<span class='fu'>par</span>(<span class='kw'>mfrow</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>3</span>,<span class='fl'>4</span>))
<span class='fu'>plot</span>(<span class='no'>GVC</span>, <span class='kw'>ylim</span> <span class='kw'>=</span> <span class='fu'>c</span>(-<span class='fl'>2.5</span>,<span class='fl'>2.5</span>))

<span class='fu'>plot</span>(<span class='no'>fitGVC</span>, <span class='kw'>ylim</span> <span class='kw'>=</span> <span class='fu'>c</span>(-<span class='fl'>2.5</span>,<span class='fl'>2.5</span>))

<span class='fu'>plot</span>(<span class='no'>fitGVC2</span>, <span class='kw'>ylim</span> <span class='kw'>=</span> <span class='fu'>c</span>(-<span class='fl'>2.5</span>,<span class='fl'>2.5</span>))
<span class='co'># }</span><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Thomas Nagler, Thibault Vatter.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
